---
title: 《应用系统体系结构》课程笔记
date: 2024-09-23 14:01:00
categories: 课程笔记
tags:
  - 架构
  - 后端
index_img:
banner_img:
excerpt: " "
---

## 9.23

### 谈谈应用架构

- 应用服务器首先为了安全考虑（比如数据库的端口不能暴露） 可以把应用和数据库、文件服务器等分开部署 通过内网访问 防止外网攻击

- 随后可以添加分布式缓存服务器 利用服务器的内存来增加读取速度 考虑到缓存需要少写 设计数据库时就可以把一张表拆分为只读数据和多写数据

- 请求一多 就需要负载均衡服务器来进行转发 比如 nginx 有一些新的问题就需要解决 比如分布式 session 的处理

- 数据一多 数据库就需要分布式部署 利用主从复制就可以做读的负载均衡 以及容灾备份 为了充分利用资源 可以轮流设为主节点 防止从节点过冷 为了保证主节点的可用性 还需要哨兵等中间件

- 图片音频一多 就需要 CDN 服务器来进行内容分发 为了单一访问 还需要一个反向代理服务器来代理这些 CDN 服务器

- 为了代码简单 可以把缓存、数据库、文件服务器的操作统一抽象成一个 API 形成统一数据访问网关

- 出现 NoSQL 数据库和搜索引擎后 数据访问的逻辑会更复杂 继续在网关里统一编写

- 为了处理异步通信 需要消息服务器

- 不同的应用服务器也可以提取出公共的服务 形成微服务架构 等待应用调用

### 服务的有状态和无状态

- http 协议是无状态的协议 即没有办法记住用户的状态

  有状态的服务是需要占用资源的 比如把实例放在内存里 但是不能无限扩大 如果要限制资源大小 又会因为 LRU 等策略导致缓冲池的抖动

  因此 要尽量使用无状态的服务 保留必需的有状态实例

- Spring Bean 的作用域（以一个service为例）
    - singleton：全局单例（默认）
    - prototype：每调用就产生一个
    - request：每进行一次http请求就产生一个
    - session：一次会话创建一个对象
    - application：一个应用只有一个对象
    - websocket：

- ![alt text](image.png)

    数据库连接池=核心数*2+有效硬盘数 与用户数无关